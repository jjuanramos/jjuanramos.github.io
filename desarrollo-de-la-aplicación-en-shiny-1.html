<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7.2 Desarrollo de la aplicación en Shiny | Herramientas de visualización interactivas para la toma de decisiones en una startup tecnológica.</title>
  <meta name="description" content="7.2 Desarrollo de la aplicación en Shiny | Herramientas de visualización interactivas para la toma de decisiones en una startup tecnológica." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="7.2 Desarrollo de la aplicación en Shiny | Herramientas de visualización interactivas para la toma de decisiones en una startup tecnológica." />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7.2 Desarrollo de la aplicación en Shiny | Herramientas de visualización interactivas para la toma de decisiones en una startup tecnológica." />
  
  
  

<meta name="author" content="Juan Ramos Hernández, Grado en Administración y dirección de Empresas" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="desarrollo-de-la-etl-pipeline.html"/>
<link rel="next" href="referencias.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/lfx-heat-0.1.0/lfx-heat-prod.js"></script>
<script src="libs/lfx-heat-0.1.0/lfx-heat-bindings.js"></script>
<script src="libs/plotly-binding-4.9.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<script src="libs/fuse_js-3.2.0/fuse_js-prod.js"></script>
<link href="libs/lfx-search-2.3.7/lfx-search-prod.css" rel="stylesheet" />
<script src="libs/lfx-search-2.3.7/lfx-search-prod.js"></script>
<script src="libs/lfx-search-2.3.7/lfx-search-bindings.js"></script>
<link href="libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.css" rel="stylesheet" />
<script src="libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introducción</a><ul>
<li class="chapter" data-level="1.1" data-path="qué-es-homyspace.html"><a href="qué-es-homyspace.html"><i class="fa fa-check"></i><b>1.1</b> ¿Qué es homyspace?</a></li>
<li class="chapter" data-level="1.2" data-path="definiciones.html"><a href="definiciones.html"><i class="fa fa-check"></i><b>1.2</b> Definiciones</a><ul>
<li class="chapter" data-level="1.2.1" data-path="definiciones.html"><a href="definiciones.html#conceptos-relacionados-con-el-mundo-start-up"><i class="fa fa-check"></i><b>1.2.1</b> Conceptos relacionados con el mundo start-up</a></li>
<li class="chapter" data-level="1.2.2" data-path="definiciones.html"><a href="definiciones.html#conceptos-relacionados-con-homyspace"><i class="fa fa-check"></i><b>1.2.2</b> Conceptos relacionados con homyspace</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="flujo-de-trabajo-de-homyspace.html"><a href="flujo-de-trabajo-de-homyspace.html"><i class="fa fa-check"></i><b>1.3</b> Flujo de trabajo de homyspace</a><ul>
<li class="chapter" data-level="1.3.1" data-path="flujo-de-trabajo-de-homyspace.html"><a href="flujo-de-trabajo-de-homyspace.html#flujo-de-proveedores"><i class="fa fa-check"></i><b>1.3.1</b> Flujo de Proveedores</a></li>
<li class="chapter" data-level="1.3.2" data-path="flujo-de-trabajo-de-homyspace.html"><a href="flujo-de-trabajo-de-homyspace.html#flujo-de-empresas"><i class="fa fa-check"></i><b>1.3.2</b> Flujo de Empresas</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="objetivos.html"><a href="objetivos.html"><i class="fa fa-check"></i><b>2</b> Objetivos</a><ul>
<li class="chapter" data-level="2.1" data-path="objetivo-general.html"><a href="objetivo-general.html"><i class="fa fa-check"></i><b>2.1</b> Objetivo General</a></li>
<li class="chapter" data-level="2.2" data-path="objetivos-específicos.html"><a href="objetivos-específicos.html"><i class="fa fa-check"></i><b>2.2</b> Objetivos Específicos</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="aplicación-de-gráficos-interactivos-para-la-toma-de-decisiones.html"><a href="aplicación-de-gráficos-interactivos-para-la-toma-de-decisiones.html"><i class="fa fa-check"></i><b>3</b> Aplicación de gráficos interactivos para la toma de decisiones</a><ul>
<li class="chapter" data-level="3.1" data-path="qué-es-un-gráfico-interactivo.html"><a href="qué-es-un-gráfico-interactivo.html"><i class="fa fa-check"></i><b>3.1</b> ¿Qué es un gráfico interactivo?</a></li>
<li class="chapter" data-level="3.2" data-path="ventajas-de-los-gráficos-interactivos-frente-a-los-estáticos.html"><a href="ventajas-de-los-gráficos-interactivos-frente-a-los-estáticos.html"><i class="fa fa-check"></i><b>3.2</b> Ventajas de los gráficos interactivos frente a los estáticos</a><ul>
<li class="chapter" data-level="3.2.1" data-path="ventajas-de-los-gráficos-interactivos-frente-a-los-estáticos.html"><a href="ventajas-de-los-gráficos-interactivos-frente-a-los-estáticos.html#inconvenientes-de-los-gráficos-interactivos"><i class="fa fa-check"></i><b>3.2.1</b> Inconvenientes de los gráficos interactivos</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="aplicación-de-gráficos-interactivos-para-la-toma-de-decisiones-aspecto-y-componentes.html"><a href="aplicación-de-gráficos-interactivos-para-la-toma-de-decisiones-aspecto-y-componentes.html"><i class="fa fa-check"></i><b>3.3</b> Aplicación de gráficos interactivos para la toma de decisiones: aspecto y componentes</a></li>
<li class="chapter" data-level="3.4" data-path="aplicación-en-el-equipo-de-proveedores.html"><a href="aplicación-en-el-equipo-de-proveedores.html"><i class="fa fa-check"></i><b>3.4</b> Aplicación en el equipo de proveedores</a><ul>
<li class="chapter" data-level="3.4.1" data-path="aplicación-en-el-equipo-de-proveedores.html"><a href="aplicación-en-el-equipo-de-proveedores.html#métodos-para-la-difusión-del-uso-de-la-aplicación"><i class="fa fa-check"></i><b>3.4.1</b> Métodos para la difusión del uso de la aplicación</a></li>
<li class="chapter" data-level="3.4.2" data-path="aplicación-en-el-equipo-de-proveedores.html"><a href="aplicación-en-el-equipo-de-proveedores.html#captación"><i class="fa fa-check"></i><b>3.4.2</b> Captación</a></li>
<li class="chapter" data-level="3.4.3" data-path="aplicación-en-el-equipo-de-proveedores.html"><a href="aplicación-en-el-equipo-de-proveedores.html#negociación"><i class="fa fa-check"></i><b>3.4.3</b> Negociación</a></li>
<li class="chapter" data-level="3.4.4" data-path="aplicación-en-el-equipo-de-proveedores.html"><a href="aplicación-en-el-equipo-de-proveedores.html#curación"><i class="fa fa-check"></i><b>3.4.4</b> Curación</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="aplicación-como-herramienta-de-inversión.html"><a href="aplicación-como-herramienta-de-inversión.html"><i class="fa fa-check"></i><b>3.5</b> Aplicación como herramienta de inversión</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="desarrollo-de-la-aplicación.html"><a href="desarrollo-de-la-aplicación.html"><i class="fa fa-check"></i><b>4</b> Desarrollo de la aplicación</a><ul>
<li class="chapter" data-level="4.1" data-path="fuente-de-datos.html"><a href="fuente-de-datos.html"><i class="fa fa-check"></i><b>4.1</b> Fuente de datos</a><ul>
<li class="chapter" data-level="4.1.1" data-path="fuente-de-datos.html"><a href="fuente-de-datos.html#introducción-1"><i class="fa fa-check"></i><b>4.1.1</b> Introducción</a></li>
<li class="chapter" data-level="4.1.2" data-path="fuente-de-datos.html"><a href="fuente-de-datos.html#etl-pipeline-definición"><i class="fa fa-check"></i><b>4.1.2</b> ETL Pipeline: Definición</a></li>
<li class="chapter" data-level="4.1.3" data-path="fuente-de-datos.html"><a href="fuente-de-datos.html#orígenes-de-datos"><i class="fa fa-check"></i><b>4.1.3</b> Orígenes de datos</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="diseño-de-la-pipeline.html"><a href="diseño-de-la-pipeline.html"><i class="fa fa-check"></i><b>4.2</b> Diseño de la Pipeline</a></li>
<li class="chapter" data-level="4.3" data-path="desarrollo-de-la-pipeline.html"><a href="desarrollo-de-la-pipeline.html"><i class="fa fa-check"></i><b>4.3</b> Desarrollo de la Pipeline</a><ul>
<li class="chapter" data-level="4.3.1" data-path="desarrollo-de-la-pipeline.html"><a href="desarrollo-de-la-pipeline.html#extracción-extract"><i class="fa fa-check"></i><b>4.3.1</b> Extracción (extract)</a></li>
<li class="chapter" data-level="4.3.2" data-path="desarrollo-de-la-pipeline.html"><a href="desarrollo-de-la-pipeline.html#transformación-transform"><i class="fa fa-check"></i><b>4.3.2</b> Transformación (transform)</a></li>
<li class="chapter" data-level="4.3.3" data-path="desarrollo-de-la-pipeline.html"><a href="desarrollo-de-la-pipeline.html#carga-load"><i class="fa fa-check"></i><b>4.3.3</b> Carga (load)</a></li>
<li class="chapter" data-level="4.3.4" data-path="desarrollo-de-la-pipeline.html"><a href="desarrollo-de-la-pipeline.html#arquitectura-final-y-gestión-de-su-actualización"><i class="fa fa-check"></i><b>4.3.4</b> Arquitectura final y gestión de su actualización</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="gráficos-interactivos.html"><a href="gráficos-interactivos.html"><i class="fa fa-check"></i><b>4.4</b> Gráficos Interactivos</a><ul>
<li class="chapter" data-level="4.4.1" data-path="gráficos-interactivos.html"><a href="gráficos-interactivos.html#introducción-2"><i class="fa fa-check"></i><b>4.4.1</b> Introducción</a></li>
<li class="chapter" data-level="4.4.2" data-path="gráficos-interactivos.html"><a href="gráficos-interactivos.html#componentes"><i class="fa fa-check"></i><b>4.4.2</b> Componentes</a></li>
<li class="chapter" data-level="4.4.3" data-path="gráficos-interactivos.html"><a href="gráficos-interactivos.html#reactividad-en-shiny-qué-es-y-cómo-aprovecharla"><i class="fa fa-check"></i><b>4.4.3</b> Reactividad en Shiny: qué es y cómo aprovecharla</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="desarrollo-de-la-aplicación-en-shiny.html"><a href="desarrollo-de-la-aplicación-en-shiny.html"><i class="fa fa-check"></i><b>4.5</b> Desarrollo de la aplicación en Shiny</a><ul>
<li class="chapter" data-level="4.5.1" data-path="desarrollo-de-la-aplicación-en-shiny.html"><a href="desarrollo-de-la-aplicación-en-shiny.html#carga-de-librerías"><i class="fa fa-check"></i><b>4.5.1</b> Carga de librerías</a></li>
<li class="chapter" data-level="4.5.2" data-path="desarrollo-de-la-aplicación-en-shiny.html"><a href="desarrollo-de-la-aplicación-en-shiny.html#creación-de-funciones"><i class="fa fa-check"></i><b>4.5.2</b> Creación de funciones</a></li>
<li class="chapter" data-level="4.5.3" data-path="desarrollo-de-la-aplicación-en-shiny.html"><a href="desarrollo-de-la-aplicación-en-shiny.html#carga-y-transformación-de-los-datos"><i class="fa fa-check"></i><b>4.5.3</b> Carga y transformación de los datos</a></li>
<li class="chapter" data-level="4.5.4" data-path="desarrollo-de-la-aplicación-en-shiny.html"><a href="desarrollo-de-la-aplicación-en-shiny.html#desarrollo-de-la-interfaz-de-usuario"><i class="fa fa-check"></i><b>4.5.4</b> Desarrollo de la interfaz de usuario</a></li>
<li class="chapter" data-level="4.5.5" data-path="desarrollo-de-la-aplicación-en-shiny.html"><a href="desarrollo-de-la-aplicación-en-shiny.html#desarrollo-de-los-gráficos-y-de-la-reactividad"><i class="fa fa-check"></i><b>4.5.5</b> Desarrollo de los gráficos y de la reactividad</a></li>
<li class="chapter" data-level="4.5.6" data-path="desarrollo-de-la-aplicación-en-shiny.html"><a href="desarrollo-de-la-aplicación-en-shiny.html#publicación-de-la-aplicación"><i class="fa fa-check"></i><b>4.5.6</b> Publicación de la aplicación</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="aspecto-final.html"><a href="aspecto-final.html"><i class="fa fa-check"></i><b>4.6</b> Aspecto Final</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="conclusión.html"><a href="conclusión.html"><i class="fa fa-check"></i><b>5</b> Conclusión</a><ul>
<li class="chapter" data-level="5.1" data-path="aprendizajes.html"><a href="aprendizajes.html"><i class="fa fa-check"></i><b>5.1</b> Aprendizajes</a></li>
<li class="chapter" data-level="5.2" data-path="a-mejorar.html"><a href="a-mejorar.html"><i class="fa fa-check"></i><b>5.2</b> A mejorar</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="índice-de-figuras.html"><a href="índice-de-figuras.html"><i class="fa fa-check"></i><b>6</b> Índice de figuras</a></li>
<li class="chapter" data-level="7" data-path="código.html"><a href="código.html"><i class="fa fa-check"></i><b>7</b> Código</a><ul>
<li class="chapter" data-level="7.1" data-path="desarrollo-de-la-etl-pipeline.html"><a href="desarrollo-de-la-etl-pipeline.html"><i class="fa fa-check"></i><b>7.1</b> Desarrollo de la ETL Pipeline</a></li>
<li class="chapter" data-level="7.2" data-path="desarrollo-de-la-aplicación-en-shiny-1.html"><a href="desarrollo-de-la-aplicación-en-shiny-1.html"><i class="fa fa-check"></i><b>7.2</b> Desarrollo de la aplicación en Shiny</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Herramientas de visualización interactivas para la toma de decisiones en una startup tecnológica.</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<html>
<img src='images/fadeupv.jpg' alt="FADE">
</html>
<div id="desarrollo-de-la-aplicación-en-shiny-1" class="section level2">
<h2><span class="header-section-number">7.2</span> Desarrollo de la aplicación en Shiny</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co">#####</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="co">##### Carga de librerías</span></a>
<a class="sourceLine" id="cb17-3" title="3"></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="co"># Relacionados con la visualización (y transformación) de datos</span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb17-6" title="6"><span class="kw">library</span>(plotly)</a>
<a class="sourceLine" id="cb17-7" title="7"><span class="kw">library</span>(leaflet)</a>
<a class="sourceLine" id="cb17-8" title="8"><span class="kw">library</span>(leaflet.extras)</a>
<a class="sourceLine" id="cb17-9" title="9"><span class="kw">library</span>(DT)</a>
<a class="sourceLine" id="cb17-10" title="10"></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="co"># Relacionados con Shiny</span></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="kw">library</span>(shiny)</a>
<a class="sourceLine" id="cb17-13" title="13"><span class="kw">library</span>(shinymanager)</a>
<a class="sourceLine" id="cb17-14" title="14"><span class="kw">library</span>(shinyWidgets)</a>
<a class="sourceLine" id="cb17-15" title="15"><span class="kw">library</span>(shinydashboard)</a>
<a class="sourceLine" id="cb17-16" title="16"><span class="kw">library</span>(shinycssloaders)</a>
<a class="sourceLine" id="cb17-17" title="17"></a>
<a class="sourceLine" id="cb17-18" title="18"><span class="co"># Relacionados con la carga (y transformación) de datos</span></a>
<a class="sourceLine" id="cb17-19" title="19"><span class="kw">library</span>(rdrop2)</a>
<a class="sourceLine" id="cb17-20" title="20"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb17-21" title="21"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb17-22" title="22"></a>
<a class="sourceLine" id="cb17-23" title="23"></a>
<a class="sourceLine" id="cb17-24" title="24"><span class="co">##### </span></a>
<a class="sourceLine" id="cb17-25" title="25"><span class="co">##### Creación de funciones</span></a>
<a class="sourceLine" id="cb17-26" title="26"></a>
<a class="sourceLine" id="cb17-27" title="27"><span class="co"># Funciones y variables para la pantalla de acceso</span></a>
<a class="sourceLine" id="cb17-28" title="28">lang &lt;-<span class="st"> </span>shinymanager<span class="op">:::</span>language<span class="op">$</span><span class="kw">new</span>()</a>
<a class="sourceLine" id="cb17-29" title="29">lang<span class="op">$</span><span class="kw">add</span>(</a>
<a class="sourceLine" id="cb17-30" title="30">  <span class="st">&quot;Please authenticate&quot;</span> =<span class="st"> &quot;Bienvenid@ al mapa de calor!&quot;</span></a>
<a class="sourceLine" id="cb17-31" title="31">)</a>
<a class="sourceLine" id="cb17-32" title="32"></a>
<a class="sourceLine" id="cb17-33" title="33">credentials &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb17-34" title="34">  <span class="dt">user =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb17-35" title="35">  <span class="dt">password =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb17-36" title="36">  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb17-37" title="37">)</a>
<a class="sourceLine" id="cb17-38" title="38"></a>
<a class="sourceLine" id="cb17-39" title="39"><span class="co"># Funciones para la transformación de datos</span></a>
<a class="sourceLine" id="cb17-40" title="40">toPercentage &lt;-<span class="st"> </span><span class="cf">function</span>(value) {</a>
<a class="sourceLine" id="cb17-41" title="41">  <span class="kw">return</span>(<span class="kw">paste0</span>(<span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span>value,<span class="dv">2</span>),<span class="st">&#39;%&#39;</span>))</a>
<a class="sourceLine" id="cb17-42" title="42">}</a>
<a class="sourceLine" id="cb17-43" title="43"></a>
<a class="sourceLine" id="cb17-44" title="44">toMoney &lt;-<span class="st"> </span><span class="cf">function</span>(value) {</a>
<a class="sourceLine" id="cb17-45" title="45">  <span class="kw">return</span>(<span class="kw">paste0</span>(<span class="kw">round</span>(value,<span class="dv">2</span>),<span class="st">&#39; euro&#39;</span>))</a>
<a class="sourceLine" id="cb17-46" title="46">}</a>
<a class="sourceLine" id="cb17-47" title="47"></a>
<a class="sourceLine" id="cb17-48" title="48"><span class="co"># Función para crear el mapa de calor, y alterar el rango de colores en función del campo seleccionado</span></a>
<a class="sourceLine" id="cb17-49" title="49">loadHeatmap &lt;-<span class="st"> </span><span class="cf">function</span>(mapData, campoColor) {</a>
<a class="sourceLine" id="cb17-50" title="50">  <span class="cf">if</span> (campoColor <span class="op">==</span><span class="st"> &quot;Número de Oportunidades&quot;</span>)</a>
<a class="sourceLine" id="cb17-51" title="51">  {</a>
<a class="sourceLine" id="cb17-52" title="52">    colorSeleccionado =<span class="st"> &quot;numOpportunities&quot;</span></a>
<a class="sourceLine" id="cb17-53" title="53">    bins &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>, <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb17-54" title="54">  }</a>
<a class="sourceLine" id="cb17-55" title="55">  </a>
<a class="sourceLine" id="cb17-56" title="56">  <span class="cf">else</span> <span class="cf">if</span> (campoColor <span class="op">==</span><span class="st"> &quot;Número de Inmuebles&quot;</span>)</a>
<a class="sourceLine" id="cb17-57" title="57">  {</a>
<a class="sourceLine" id="cb17-58" title="58">    colorSeleccionado =<span class="st"> &quot;numberProperties&quot;</span></a>
<a class="sourceLine" id="cb17-59" title="59">    bins &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>, <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb17-60" title="60">  }</a>
<a class="sourceLine" id="cb17-61" title="61">  </a>
<a class="sourceLine" id="cb17-62" title="62">  <span class="cf">else</span> <span class="cf">if</span> (campoColor <span class="op">==</span><span class="st"> &quot;Número de Propuestas Aceptadas&quot;</span>)</a>
<a class="sourceLine" id="cb17-63" title="63">  {</a>
<a class="sourceLine" id="cb17-64" title="64">    colorSeleccionado =<span class="st"> &quot;acceptedProposals&quot;</span></a>
<a class="sourceLine" id="cb17-65" title="65">    bins &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>, <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb17-66" title="66">  }</a>
<a class="sourceLine" id="cb17-67" title="67">  </a>
<a class="sourceLine" id="cb17-68" title="68">  pal &lt;-<span class="st"> </span><span class="kw">colorBin</span>(<span class="st">&quot;YlOrRd&quot;</span>, <span class="dt">domain =</span> mapData[[colorSeleccionado]], <span class="dt">bins =</span> bins)</a>
<a class="sourceLine" id="cb17-69" title="69">  </a>
<a class="sourceLine" id="cb17-70" title="70">  mapData <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-71" title="71"><span class="st">    </span><span class="kw">leaflet</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-72" title="72"><span class="st">    </span><span class="kw">setView</span>(<span class="dt">lng =</span> <span class="fl">-3.6</span>, <span class="dt">lat =</span> <span class="fl">40.45</span>, <span class="dt">zoom =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-73" title="73"><span class="st">    </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-74" title="74"><span class="st">    </span><span class="kw">addPolygons</span>(</a>
<a class="sourceLine" id="cb17-75" title="75">      <span class="dt">layerId =</span> <span class="op">~</span>distrito,</a>
<a class="sourceLine" id="cb17-76" title="76">      <span class="dt">label =</span> <span class="op">~</span>distrito,</a>
<a class="sourceLine" id="cb17-77" title="77">      <span class="dt">popup =</span> <span class="op">~</span>relevantInfo,</a>
<a class="sourceLine" id="cb17-78" title="78">      <span class="dt">fillColor =</span> <span class="op">~</span><span class="kw">pal</span>(mapData[[colorSeleccionado]]),</a>
<a class="sourceLine" id="cb17-79" title="79">      <span class="dt">color =</span> <span class="st">&quot;#444444&quot;</span>,</a>
<a class="sourceLine" id="cb17-80" title="80">      <span class="dt">weight =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb17-81" title="81">      <span class="dt">smoothFactor =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb17-82" title="82">      <span class="dt">opacity =</span> <span class="fl">1.0</span>,</a>
<a class="sourceLine" id="cb17-83" title="83">      <span class="dt">fillOpacity =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb17-84" title="84">      <span class="dt">highlightOptions =</span> <span class="kw">highlightOptions</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>,</a>
<a class="sourceLine" id="cb17-85" title="85">                                          <span class="dt">weight =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb17-86" title="86">                                          <span class="dt">bringToFront =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-87" title="87">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-88" title="88"><span class="st">    </span><span class="co"># addTiles() %&gt;%</span></a>
<a class="sourceLine" id="cb17-89" title="89"><span class="st">    </span><span class="co"># addAwesomeMarkers(</span></a>
<a class="sourceLine" id="cb17-90" title="90"><span class="st">    </span><span class="co">#   data = inmuebles,</span></a>
<a class="sourceLine" id="cb17-91" title="91"><span class="st">    </span><span class="co">#   lng = ~lon,</span></a>
<a class="sourceLine" id="cb17-92" title="92"><span class="st">    </span><span class="co">#   lat = ~lat,</span></a>
<a class="sourceLine" id="cb17-93" title="93"><span class="st">    </span><span class="co">#   label = ~BX.ID,</span></a>
<a class="sourceLine" id="cb17-94" title="94"><span class="st">    </span><span class="co">#   layerId = ~distrito,</span></a>
<a class="sourceLine" id="cb17-95" title="95"><span class="st">    </span><span class="co">#   popup = ~relevantInfo</span></a>
<a class="sourceLine" id="cb17-96" title="96"><span class="st">    </span><span class="co"># ) %&gt;%</span></a>
<a class="sourceLine" id="cb17-97" title="97"><span class="st">    </span><span class="kw">addSearchOSM</span>(<span class="dt">options =</span> <span class="kw">searchOptions</span>(<span class="dt">autoCollapse =</span> <span class="ot">TRUE</span>, <span class="dt">minLength =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb17-98" title="98">}</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="co">#####</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="co">##### Carga y transformación de los datos</span></a>
<a class="sourceLine" id="cb18-3" title="3"></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="co"># Carga de la shapefile con los distritos</span></a>
<a class="sourceLine" id="cb18-5" title="5">token &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;droptoken.rds&quot;</span>)</a>
<a class="sourceLine" id="cb18-6" title="6"><span class="kw">drop_download</span>(<span class="st">&quot;/heatmap.zip&quot;</span>, <span class="dt">dtoken =</span> token, <span class="dt">overwrite =</span> T)</a>
<a class="sourceLine" id="cb18-7" title="7"><span class="kw">unzip</span>(<span class="st">&quot;heatmap.zip&quot;</span>)</a>
<a class="sourceLine" id="cb18-8" title="8">polyData &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="dt">dsn =</span> <span class="kw">path.expand</span>(<span class="st">&quot;heatmap.shp&quot;</span>), <span class="dt">layer=</span><span class="st">&quot;heatmap&quot;</span>)</a>
<a class="sourceLine" id="cb18-9" title="9">polyData &lt;-<span class="st"> </span>polyData <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb18-10" title="10">  <span class="st">&quot;proposalsNumber&quot;</span> =<span class="st"> &quot;proposalsN&quot;</span>,</a>
<a class="sourceLine" id="cb18-11" title="11">  <span class="st">&quot;acceptedProposals&quot;</span> =<span class="st"> &quot;acceptedPr&quot;</span>,</a>
<a class="sourceLine" id="cb18-12" title="12">  <span class="st">&quot;numberProperties&quot;</span> =<span class="st"> &quot;numberProp&quot;</span>,</a>
<a class="sourceLine" id="cb18-13" title="13">  <span class="st">&quot;0_rooms&quot;</span> =<span class="st"> &quot;X0.0&quot;</span>,</a>
<a class="sourceLine" id="cb18-14" title="14">  <span class="st">&quot;1_rooms&quot;</span> =<span class="st"> &quot;X1.0&quot;</span>,</a>
<a class="sourceLine" id="cb18-15" title="15">  <span class="st">&quot;2_rooms&quot;</span> =<span class="st"> &quot;X2.0&quot;</span>,</a>
<a class="sourceLine" id="cb18-16" title="16">  <span class="st">&quot;3_rooms&quot;</span> =<span class="st"> &quot;X3.0&quot;</span>,</a>
<a class="sourceLine" id="cb18-17" title="17">  <span class="st">&quot;4_rooms&quot;</span> =<span class="st"> &quot;X4.0&quot;</span>,</a>
<a class="sourceLine" id="cb18-18" title="18">  <span class="st">&quot;more4_rooms&quot;</span> =<span class="st"> &quot;X.4&quot;</span>,</a>
<a class="sourceLine" id="cb18-19" title="19">  <span class="st">&quot;propertyCity&quot;</span> =<span class="st"> &quot;propertyCi&quot;</span>,</a>
<a class="sourceLine" id="cb18-20" title="20">  <span class="st">&quot;numberPropertiesProposed&quot;</span> =<span class="st"> &quot;numberPr_1&quot;</span>,</a>
<a class="sourceLine" id="cb18-21" title="21">  <span class="st">&quot;numberPropertiesConverted&quot;</span> =<span class="st"> &quot;numberPr_2&quot;</span>,</a>
<a class="sourceLine" id="cb18-22" title="22">  <span class="st">&quot;percentagePropertiesProposed&quot;</span> =<span class="st"> &quot;properties&quot;</span>,</a>
<a class="sourceLine" id="cb18-23" title="23">  <span class="st">&quot;conversionRatioProperties&quot;</span> =<span class="st"> &quot;properti_1&quot;</span>,</a>
<a class="sourceLine" id="cb18-24" title="24">  <span class="st">&quot;numOpportunities&quot;</span> =<span class="st"> &quot;numOpportu&quot;</span>,</a>
<a class="sourceLine" id="cb18-25" title="25">  <span class="st">&quot;numBookings&quot;</span> =<span class="st"> &quot;numBooking&quot;</span>,</a>
<a class="sourceLine" id="cb18-26" title="26">  <span class="st">&quot;conversionRatio&quot;</span> =<span class="st"> &quot;conversion&quot;</span></a>
<a class="sourceLine" id="cb18-27" title="27">)</a>
<a class="sourceLine" id="cb18-28" title="28"></a>
<a class="sourceLine" id="cb18-29" title="29">polyData<span class="op">$</span>propertyCity &lt;-<span class="st"> </span><span class="kw">factor</span>(polyData<span class="op">$</span>propertyCity)</a>
<a class="sourceLine" id="cb18-30" title="30">polyData<span class="op">$</span>municipio &lt;-<span class="st"> </span><span class="kw">factor</span>(polyData<span class="op">$</span>municipio)</a>
<a class="sourceLine" id="cb18-31" title="31">polyData<span class="op">$</span>distrito &lt;-<span class="st"> </span><span class="kw">factor</span>(polyData<span class="op">$</span>distrito)</a>
<a class="sourceLine" id="cb18-32" title="32">polyData<span class="op">$</span><span class="st">`</span><span class="dt">12_rooms</span><span class="st">`</span> &lt;-<span class="st"> </span>(polyData<span class="op">$</span><span class="st">`</span><span class="dt">1_rooms</span><span class="st">`</span> <span class="op">+</span><span class="st"> </span>polyData<span class="op">$</span><span class="st">`</span><span class="dt">2_rooms</span><span class="st">`</span>)<span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb18-33" title="33"><span class="co"># Creación del texto que aparecerá al clickar en el distrito</span></a>
<a class="sourceLine" id="cb18-34" title="34">polyData<span class="op">$</span>relevantInfo &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;&lt;strong&gt;Distrito:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-35" title="35">                               polyData<span class="op">$</span>distrito, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-36" title="36">                               <span class="st">&quot;&lt;strong&gt;Oportunidades:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-37" title="37">                               polyData<span class="op">$</span>numOpportunities, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-38" title="38">                               <span class="st">&quot;&lt;strong&gt;Reservas:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-39" title="39">                               polyData<span class="op">$</span>numBookings, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-40" title="40">                               <span class="st">&quot;&lt;strong&gt;Ratio de Conversión:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-41" title="41">                               <span class="kw">toPercentage</span>(polyData<span class="op">$</span>conversionRatio), <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-42" title="42">                               <span class="st">&quot;&lt;strong&gt;Inmuebles:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-43" title="43">                               polyData<span class="op">$</span>numberProperties, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-44" title="44">                               <span class="st">&quot;&lt;strong&gt;Inmuebles propuestos:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-45" title="45">                               polyData<span class="op">$</span>numberPropertiesProposed, <span class="kw">paste</span>(<span class="st">&quot;(&quot;</span>, <span class="kw">toPercentage</span>(polyData<span class="op">$</span>percentagePropertiesProposed), <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>), <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-46" title="46">                               <span class="st">&quot;&lt;strong&gt;Inmuebles reservados:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-47" title="47">                               polyData<span class="op">$</span>numberPropertiesConverted, <span class="kw">paste</span>(<span class="st">&quot;(&quot;</span>, <span class="kw">toPercentage</span>(polyData<span class="op">$</span>conversionRatioProperties), <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>), <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-48" title="48">                               <span class="st">&quot;&lt;strong&gt;Propuestas Hechas:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-49" title="49">                               polyData<span class="op">$</span>proposalsNumber, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-50" title="50">                               <span class="st">&quot;&lt;strong&gt;Propuestas Aceptadas:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-51" title="51">                               polyData<span class="op">$</span>acceptedProposals, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-52" title="52">                               <span class="st">&quot;&lt;strong&gt;Benchmark:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-53" title="53">                               <span class="kw">toPercentage</span>(polyData<span class="op">$</span>benchmark), <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-54" title="54">                               <span class="st">&quot;&lt;strong&gt;Precio Medio (1 y 2 habitaciones):&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-55" title="55">                               <span class="kw">toMoney</span>(polyData<span class="op">$</span><span class="st">`</span><span class="dt">12_rooms</span><span class="st">`</span>), <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-56" title="56">                               <span class="st">&quot;&lt;strong&gt;Estancia Media:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-57" title="57">                               polyData<span class="op">$</span>duration)</a>
<a class="sourceLine" id="cb18-58" title="58"></a>
<a class="sourceLine" id="cb18-59" title="59"><span class="co"># Carga de los csv de los que se alimentarán los gráficos</span></a>
<a class="sourceLine" id="cb18-60" title="60">heatmapData &lt;-<span class="st"> </span><span class="kw">drop_read_csv</span>(<span class="st">&quot;/heatmapData.csv&quot;</span>, <span class="dt">dtoken =</span> token)</a>
<a class="sourceLine" id="cb18-61" title="61">heatmapData<span class="op">$</span>distrito &lt;-<span class="st"> </span><span class="kw">factor</span>(heatmapData<span class="op">$</span>distrito)</a>
<a class="sourceLine" id="cb18-62" title="62">heatmapData<span class="op">$</span>rooms &lt;-<span class="st"> </span><span class="kw">factor</span>(heatmapData<span class="op">$</span>rooms)</a>
<a class="sourceLine" id="cb18-63" title="63">heatmapData<span class="op">$</span>beds &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">as.integer</span>(heatmapData<span class="op">$</span>beds))</a>
<a class="sourceLine" id="cb18-64" title="64">heatmapData<span class="op">$</span>duration &lt;-<span class="st"> </span><span class="kw">round</span>(heatmapData<span class="op">$</span>duration)</a>
<a class="sourceLine" id="cb18-65" title="65"></a>
<a class="sourceLine" id="cb18-66" title="66">properties &lt;-<span class="st"> </span><span class="kw">drop_read_csv</span>(<span class="st">&quot;/properties.csv&quot;</span>, <span class="dt">dtoken =</span> token)</a>
<a class="sourceLine" id="cb18-67" title="67">properties<span class="op">$</span>distrito &lt;-<span class="st"> </span><span class="kw">factor</span>(properties<span class="op">$</span>distrito)</a>
<a class="sourceLine" id="cb18-68" title="68">properties<span class="op">$</span>distrito &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;&quot;</span>, properties<span class="op">$</span>distrito)</a>
<a class="sourceLine" id="cb18-69" title="69">properties<span class="op">$</span>distrito &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;None&quot;</span>, <span class="ot">NA</span>, properties<span class="op">$</span>distrito)</a>
<a class="sourceLine" id="cb18-70" title="70">properties<span class="op">$</span>distrito &lt;-<span class="st"> </span><span class="kw">factor</span>(properties<span class="op">$</span>distrito)</a>
<a class="sourceLine" id="cb18-71" title="71">properties<span class="op">$</span>rooms &lt;-<span class="st"> </span><span class="kw">factor</span>(properties<span class="op">$</span>rooms)</a>
<a class="sourceLine" id="cb18-72" title="72">properties<span class="op">$</span>hasICal &lt;-<span class="st"> </span><span class="kw">as.logical</span>(properties<span class="op">$</span>hasICal)</a>
<a class="sourceLine" id="cb18-73" title="73">properties<span class="op">$</span>municipio &lt;-<span class="st"> </span><span class="kw">factor</span>(properties<span class="op">$</span>municipio)</a>
<a class="sourceLine" id="cb18-74" title="74"></a>
<a class="sourceLine" id="cb18-75" title="75"><span class="co"># Carga de información de inversores, si tuviéramos</span></a>
<a class="sourceLine" id="cb18-76" title="76"></a>
<a class="sourceLine" id="cb18-77" title="77">inmuebles &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;inmuebles.csv&quot;</span>, <span class="dt">encoding=</span><span class="st">&quot;UTF-8&quot;</span>)</a>
<a class="sourceLine" id="cb18-78" title="78">inmuebles &lt;-<span class="st"> </span>inmuebles <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb18-79" title="79">  <span class="st">&quot;proposalsNumber&quot;</span> =<span class="st"> &quot;proposalsN&quot;</span>,</a>
<a class="sourceLine" id="cb18-80" title="80">  <span class="st">&quot;acceptedProposals&quot;</span> =<span class="st"> &quot;acceptedPr&quot;</span>,</a>
<a class="sourceLine" id="cb18-81" title="81">  <span class="st">&quot;numberProperties&quot;</span> =<span class="st"> &quot;numberProp&quot;</span>,</a>
<a class="sourceLine" id="cb18-82" title="82">  <span class="st">&quot;0_rooms&quot;</span> =<span class="st"> &quot;X0.0&quot;</span>,</a>
<a class="sourceLine" id="cb18-83" title="83">  <span class="st">&quot;1_rooms&quot;</span> =<span class="st"> &quot;X1.0&quot;</span>,</a>
<a class="sourceLine" id="cb18-84" title="84">  <span class="st">&quot;2_rooms&quot;</span> =<span class="st"> &quot;X2.0&quot;</span>,</a>
<a class="sourceLine" id="cb18-85" title="85">  <span class="st">&quot;3_rooms&quot;</span> =<span class="st"> &quot;X3.0&quot;</span>,</a>
<a class="sourceLine" id="cb18-86" title="86">  <span class="st">&quot;4_rooms&quot;</span> =<span class="st"> &quot;X4.0&quot;</span>,</a>
<a class="sourceLine" id="cb18-87" title="87">  <span class="st">&quot;more4_rooms&quot;</span> =<span class="st"> &quot;X.4&quot;</span>,</a>
<a class="sourceLine" id="cb18-88" title="88">  <span class="st">&quot;propertyCity&quot;</span> =<span class="st"> &quot;propertyCi&quot;</span>,</a>
<a class="sourceLine" id="cb18-89" title="89">  <span class="st">&quot;numberPropertiesProposed&quot;</span> =<span class="st"> &quot;numberPr_1&quot;</span>,</a>
<a class="sourceLine" id="cb18-90" title="90">  <span class="st">&quot;numberPropertiesConverted&quot;</span> =<span class="st"> &quot;numberPr_2&quot;</span>,</a>
<a class="sourceLine" id="cb18-91" title="91">  <span class="st">&quot;percentagePropertiesProposed&quot;</span> =<span class="st"> &quot;properties&quot;</span>,</a>
<a class="sourceLine" id="cb18-92" title="92">  <span class="st">&quot;conversionRatioProperties&quot;</span> =<span class="st"> &quot;properti_1&quot;</span>,</a>
<a class="sourceLine" id="cb18-93" title="93">  <span class="st">&quot;numOpportunities&quot;</span> =<span class="st"> &quot;numOpportu&quot;</span>,</a>
<a class="sourceLine" id="cb18-94" title="94">  <span class="st">&quot;numBookings&quot;</span> =<span class="st"> &quot;numBooking&quot;</span>,</a>
<a class="sourceLine" id="cb18-95" title="95">  <span class="st">&quot;conversionRatio&quot;</span> =<span class="st"> &quot;conversion&quot;</span></a>
<a class="sourceLine" id="cb18-96" title="96">)</a>
<a class="sourceLine" id="cb18-97" title="97">inmuebles<span class="op">$</span>lon &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(inmuebles<span class="op">$</span>lon)</a>
<a class="sourceLine" id="cb18-98" title="98">inmuebles<span class="op">$</span>lat &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(inmuebles<span class="op">$</span>lat)</a>
<a class="sourceLine" id="cb18-99" title="99">inmuebles<span class="op">$</span><span class="st">`</span><span class="dt">1_rooms</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(inmuebles<span class="op">$</span><span class="st">`</span><span class="dt">1_rooms</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb18-100" title="100">inmuebles<span class="op">$</span><span class="st">`</span><span class="dt">2_rooms</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(inmuebles<span class="op">$</span><span class="st">`</span><span class="dt">2_rooms</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb18-101" title="101">inmuebles<span class="op">$</span><span class="st">`</span><span class="dt">12_rooms</span><span class="st">`</span> &lt;-<span class="st"> </span>(inmuebles<span class="op">$</span><span class="st">`</span><span class="dt">1_rooms</span><span class="st">`</span> <span class="op">+</span><span class="st"> </span>inmuebles<span class="op">$</span><span class="st">`</span><span class="dt">2_rooms</span><span class="st">`</span>)<span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb18-102" title="102">inmuebles<span class="op">$</span>relevantInfo &lt;-<span class="st"> </span><span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb18-103" title="103">                               <span class="st">&quot;&lt;strong&gt;ID:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-104" title="104">                               inmuebles<span class="op">$</span>BX.ID, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-105" title="105">                               <span class="st">&quot;&lt;strong&gt;Inmuebles 0 habitaciones:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-106" title="106">                               inmuebles<span class="op">$</span>X0D.Units, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-107" title="107">                               <span class="st">&quot;&lt;strong&gt;Inmuebles 1 habitaciones:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-108" title="108">                               inmuebles<span class="op">$</span>X1D.Units, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-109" title="109">                               <span class="st">&quot;&lt;strong&gt;Inmuebles 2 habitaciones:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-110" title="110">                               inmuebles<span class="op">$</span>X2D.Units, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-111" title="111">                               <span class="st">&quot;&lt;strong&gt;Inmuebles 3 habitaciones:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-112" title="112">                               inmuebles<span class="op">$</span>X3D.Units, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-113" title="113">                               <span class="st">&quot;&lt;strong&gt;Inmuebles 4 habitaciones:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-114" title="114">                               inmuebles<span class="op">$</span>X4D.Units, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-115" title="115">                               <span class="st">&quot;&lt;strong&gt;Inmuebles 5 habitaciones:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-116" title="116">                               inmuebles<span class="op">$</span>X5D.Units, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-117" title="117">                               <span class="st">&quot;&lt;strong&gt;Capex:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-118" title="118">                               inmuebles<span class="op">$</span>capex, <span class="st">&quot;&lt;br&gt;&quot;</span>, <span class="st">&quot;&lt;hr&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-119" title="119">                               <span class="st">&quot;&lt;strong&gt;Distrito:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-120" title="120">                               inmuebles<span class="op">$</span>distrito, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-121" title="121">                               <span class="st">&quot;&lt;strong&gt;Oportunidades:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-122" title="122">                               inmuebles<span class="op">$</span>numOpportunities, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-123" title="123">                               <span class="st">&quot;&lt;strong&gt;Reservas:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-124" title="124">                               inmuebles<span class="op">$</span>numBookings, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-125" title="125">                               <span class="st">&quot;&lt;strong&gt;Ratio de Conversión:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-126" title="126">                               <span class="kw">toPercentage</span>(inmuebles<span class="op">$</span>conversionRatio), <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-127" title="127">                               <span class="st">&quot;&lt;strong&gt;Inmuebles:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-128" title="128">                               inmuebles<span class="op">$</span>numberProperties, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-129" title="129">                               <span class="st">&quot;&lt;strong&gt;Inmuebles propuestos:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-130" title="130">                               inmuebles<span class="op">$</span>numberPropertiesProposed, <span class="kw">paste</span>(<span class="st">&quot;(&quot;</span>, <span class="kw">toPercentage</span>(inmuebles<span class="op">$</span>percentagePropertiesProposed), <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>), <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-131" title="131">                               <span class="st">&quot;&lt;strong&gt;Inmuebles reservados:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-132" title="132">                               inmuebles<span class="op">$</span>numberPropertiesConverted, <span class="kw">paste</span>(<span class="st">&quot;(&quot;</span>, <span class="kw">toPercentage</span>(inmuebles<span class="op">$</span>conversionRatioProperties), <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>), <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-133" title="133">                               <span class="st">&quot;&lt;strong&gt;Propuestas Hechas:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-134" title="134">                               inmuebles<span class="op">$</span>proposalsNumber, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-135" title="135">                               <span class="st">&quot;&lt;strong&gt;Propuestas Aceptadas:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-136" title="136">                               inmuebles<span class="op">$</span>acceptedProposals, <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-137" title="137">                               <span class="st">&quot;&lt;strong&gt;Benchmark:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-138" title="138">                               <span class="kw">toPercentage</span>(inmuebles<span class="op">$</span>benchmark), <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-139" title="139">                               <span class="st">&quot;&lt;strong&gt;Precio Medio (1 y 2 habitaciones):&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-140" title="140">                               <span class="kw">toMoney</span>(inmuebles<span class="op">$</span><span class="st">`</span><span class="dt">12_rooms</span><span class="st">`</span>), <span class="st">&quot;&lt;br&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-141" title="141">                               <span class="st">&quot;&lt;strong&gt;Estancia Media:&lt;/strong&gt;&quot;</span>,</a>
<a class="sourceLine" id="cb18-142" title="142">                               inmuebles<span class="op">$</span>duration)</a></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co">#####</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="co">##### Diseño de la interfaz de usuario</span></a>
<a class="sourceLine" id="cb19-3" title="3"></a>
<a class="sourceLine" id="cb19-4" title="4">title &lt;-<span class="st"> </span>tags<span class="op">$</span><span class="kw">a</span>(<span class="dt">href=</span><span class="st">&quot;homyspace.com&quot;</span>,</a>
<a class="sourceLine" id="cb19-5" title="5">                tags<span class="op">$</span><span class="kw">img</span>(<span class="dt">src=</span><span class="st">&quot;http://homybrain.com/img/logo.png&quot;</span>, <span class="dt">width =</span> <span class="st">&quot;200&quot;</span>))</a>
<a class="sourceLine" id="cb19-6" title="6"></a>
<a class="sourceLine" id="cb19-7" title="7"></a>
<a class="sourceLine" id="cb19-8" title="8">ui &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb19-9" title="9"><span class="st">  </span><span class="kw">secure_app</span>(</a>
<a class="sourceLine" id="cb19-10" title="10">    <span class="dt">theme =</span> shinythemes<span class="op">::</span><span class="kw">shinytheme</span>(<span class="st">&quot;flatly&quot;</span>),</a>
<a class="sourceLine" id="cb19-11" title="11">    <span class="kw">dashboardPage</span>(</a>
<a class="sourceLine" id="cb19-12" title="12">      <span class="dt">title =</span> <span class="st">&quot;homyspace&quot;</span>,</a>
<a class="sourceLine" id="cb19-13" title="13">      <span class="kw">dashboardHeader</span>(<span class="dt">title =</span> title),</a>
<a class="sourceLine" id="cb19-14" title="14">      <span class="kw">dashboardSidebar</span>(</a>
<a class="sourceLine" id="cb19-15" title="15">        <span class="dt">collapsed =</span> T,</a>
<a class="sourceLine" id="cb19-16" title="16">        <span class="kw">pickerInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;propertyCity&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Filtra por ciudad&quot;</span>, <span class="dt">choices =</span> <span class="kw">levels</span>(polyData<span class="op">$</span>propertyCity), <span class="dt">selected =</span> <span class="kw">levels</span>(polyData<span class="op">$</span>propertyCity), <span class="dt">multiple =</span> T, <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb19-17" title="17">          <span class="st">`</span><span class="dt">actions-box</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb19-18" title="18">          <span class="dt">size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb19-19" title="19">          <span class="st">`</span><span class="dt">live-search</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb19-20" title="20">        )),</a>
<a class="sourceLine" id="cb19-21" title="21">        <span class="kw">pickerInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;municipio&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Filtra por municipio&quot;</span>, <span class="dt">choices =</span> <span class="kw">levels</span>(polyData<span class="op">$</span>municipio), <span class="dt">selected =</span> <span class="kw">levels</span>(polyData<span class="op">$</span>municipio), <span class="dt">multiple =</span> T, <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb19-22" title="22">          <span class="st">`</span><span class="dt">actions-box</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb19-23" title="23">          <span class="dt">size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb19-24" title="24">          <span class="st">`</span><span class="dt">live-search</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb19-25" title="25">        )),</a>
<a class="sourceLine" id="cb19-26" title="26">        <span class="kw">pickerInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;distrito&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Filtra por distrito&quot;</span>, <span class="dt">choices =</span> <span class="kw">levels</span>(polyData<span class="op">$</span>distrito), <span class="dt">selected =</span> <span class="kw">levels</span>(polyData<span class="op">$</span>distrito), <span class="dt">multiple =</span> T, <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb19-27" title="27">          <span class="st">`</span><span class="dt">actions-box</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb19-28" title="28">          <span class="dt">size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb19-29" title="29">          <span class="st">`</span><span class="dt">live-search</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb19-30" title="30">        )),</a>
<a class="sourceLine" id="cb19-31" title="31">        <span class="kw">pickerInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;beds&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Filtra por número de camas&quot;</span>, <span class="dt">choices =</span> <span class="kw">levels</span>(heatmapData<span class="op">$</span>beds), <span class="dt">selected =</span> <span class="kw">levels</span>(heatmapData<span class="op">$</span>beds), <span class="dt">multiple =</span> T, <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb19-32" title="32">          <span class="st">`</span><span class="dt">actions-box</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb19-33" title="33">          <span class="dt">size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb19-34" title="34">          <span class="st">`</span><span class="dt">live-search</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb19-35" title="35">        )),</a>
<a class="sourceLine" id="cb19-36" title="36">        <span class="kw">pickerInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;rooms&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Filtra por número de habitaciones&quot;</span>, <span class="dt">choices =</span> <span class="kw">levels</span>(heatmapData<span class="op">$</span>rooms), <span class="dt">selected =</span> <span class="kw">levels</span>(heatmapData<span class="op">$</span>rooms), <span class="dt">multiple =</span> T, <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb19-37" title="37">          <span class="st">`</span><span class="dt">actions-box</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb19-38" title="38">          <span class="dt">size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb19-39" title="39">          <span class="st">`</span><span class="dt">live-search</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb19-40" title="40">        ))</a>
<a class="sourceLine" id="cb19-41" title="41">      ),</a>
<a class="sourceLine" id="cb19-42" title="42">      <span class="kw">dashboardBody</span>(</a>
<a class="sourceLine" id="cb19-43" title="43">        tags<span class="op">$</span><span class="kw">head</span>(tags<span class="op">$</span><span class="kw">style</span>(<span class="kw">HTML</span>(<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb19-44" title="44"><span class="st">      .skin-blue .main-header .logo {</span></a>
<a class="sourceLine" id="cb19-45" title="45"><span class="st">        font-family: &quot;Nexa Bold&quot;;</span></a>
<a class="sourceLine" id="cb19-46" title="46"><span class="st">        font-size: 24px;</span></a>
<a class="sourceLine" id="cb19-47" title="47"><span class="st">        color: #000000;</span></a>
<a class="sourceLine" id="cb19-48" title="48"><span class="st">        background-color: #eeaf30;</span></a>
<a class="sourceLine" id="cb19-49" title="49"><span class="st">      }</span></a>
<a class="sourceLine" id="cb19-50" title="50"><span class="st"> </span></a>
<a class="sourceLine" id="cb19-51" title="51"><span class="st">      /* navbar (rest of the header) */</span></a>
<a class="sourceLine" id="cb19-52" title="52"><span class="st">      .skin-blue .main-header .navbar {</span></a>
<a class="sourceLine" id="cb19-53" title="53"><span class="st">      background-color: #eeaf30;</span></a>
<a class="sourceLine" id="cb19-54" title="54"><span class="st">      color: #000000;</span></a>
<a class="sourceLine" id="cb19-55" title="55"><span class="st">      }</span></a>
<a class="sourceLine" id="cb19-56" title="56"><span class="st">    &#39;</span>))),</a>
<a class="sourceLine" id="cb19-57" title="57">        <span class="kw">fluidRow</span>(</a>
<a class="sourceLine" id="cb19-58" title="58">          <span class="kw">h3</span>(<span class="st">&quot;Selecciona en función de qué campo colorear el mapa de calor&quot;</span>)</a>
<a class="sourceLine" id="cb19-59" title="59">        ),</a>
<a class="sourceLine" id="cb19-60" title="60">        <span class="kw">fluidRow</span>(</a>
<a class="sourceLine" id="cb19-61" title="61">          <span class="kw">pickerInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;color&quot;</span>, <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;Número de Oportunidades&quot;</span>, <span class="st">&quot;Número de Inmuebles&quot;</span>, <span class="st">&quot;Número de Propuestas Aceptadas&quot;</span>), <span class="dt">selected =</span> <span class="st">&quot;Número de Oportunidades&quot;</span>, <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb19-62" title="62">            <span class="st">`</span><span class="dt">actions-box</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb19-63" title="63">            <span class="dt">size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb19-64" title="64">            <span class="st">`</span><span class="dt">live-search</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb19-65" title="65">          ))</a>
<a class="sourceLine" id="cb19-66" title="66">        ),</a>
<a class="sourceLine" id="cb19-67" title="67">        <span class="kw">fluidRow</span>(</a>
<a class="sourceLine" id="cb19-68" title="68">          <span class="kw">leafletOutput</span>(<span class="st">&quot;heatmap&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-69" title="69"><span class="st">            </span><span class="kw">withSpinner</span>(<span class="dt">color=</span><span class="st">&quot;#EEAF30&quot;</span>)</a>
<a class="sourceLine" id="cb19-70" title="70">        ),</a>
<a class="sourceLine" id="cb19-71" title="71">        <span class="kw">fluidRow</span>(</a>
<a class="sourceLine" id="cb19-72" title="72">          <span class="kw">column</span>(<span class="dv">6</span>, <span class="kw">plotlyOutput</span>(<span class="st">&quot;pricesLine&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-73" title="73"><span class="st">                   </span><span class="kw">withSpinner</span>(<span class="dt">color=</span><span class="st">&quot;#EEAF30&quot;</span>)),</a>
<a class="sourceLine" id="cb19-74" title="74">          <span class="kw">column</span>(<span class="dv">6</span>, <span class="kw">plotlyOutput</span>(<span class="st">&quot;roomsBar&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-75" title="75"><span class="st">                   </span><span class="kw">withSpinner</span>(<span class="dt">color=</span><span class="st">&quot;#EEAF30&quot;</span>))</a>
<a class="sourceLine" id="cb19-76" title="76">        ),</a>
<a class="sourceLine" id="cb19-77" title="77">        <span class="kw">fluidRow</span>(</a>
<a class="sourceLine" id="cb19-78" title="78">          <span class="kw">column</span>(<span class="dv">6</span>, <span class="kw">plotlyOutput</span>(<span class="st">&quot;roomsPerDistrict&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-79" title="79"><span class="st">                   </span><span class="kw">withSpinner</span>(<span class="dt">color=</span><span class="st">&quot;#EEAF30&quot;</span>)),</a>
<a class="sourceLine" id="cb19-80" title="80">          <span class="kw">column</span>(<span class="dv">6</span>, <span class="kw">plotlyOutput</span>(<span class="st">&quot;hasIcal&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-81" title="81"><span class="st">                   </span><span class="kw">withSpinner</span>(<span class="dt">color=</span><span class="st">&quot;#EEAF30&quot;</span>))</a>
<a class="sourceLine" id="cb19-82" title="82">        ),</a>
<a class="sourceLine" id="cb19-83" title="83">        <span class="kw">h3</span>(<span class="st">&quot;Resumen por distrito&quot;</span>),</a>
<a class="sourceLine" id="cb19-84" title="84">        <span class="kw">fluidRow</span>(</a>
<a class="sourceLine" id="cb19-85" title="85">          <span class="kw">dataTableOutput</span>(<span class="st">&quot;dataDistrito&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-86" title="86"><span class="st">            </span><span class="kw">withSpinner</span>(<span class="dt">color=</span><span class="st">&quot;#EEAF30&quot;</span>)</a>
<a class="sourceLine" id="cb19-87" title="87">        )</a>
<a class="sourceLine" id="cb19-88" title="88">      )</a>
<a class="sourceLine" id="cb19-89" title="89">    )</a>
<a class="sourceLine" id="cb19-90" title="90">  )</a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="co">#####</span></a>
<a class="sourceLine" id="cb20-2" title="2"><span class="co">##### Desarrollo de los gráficos y de la reactividad (servidor)</span></a>
<a class="sourceLine" id="cb20-3" title="3"></a>
<a class="sourceLine" id="cb20-4" title="4">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb20-5" title="5">  result_auth &lt;-<span class="st"> </span><span class="kw">secure_server</span>(<span class="dt">check_credentials =</span> <span class="kw">check_credentials</span>(credentials))</a>
<a class="sourceLine" id="cb20-6" title="6">  </a>
<a class="sourceLine" id="cb20-7" title="7">  <span class="co"># observe({</span></a>
<a class="sourceLine" id="cb20-8" title="8">  <span class="co">#   event &lt;- input$propertyCity</span></a>
<a class="sourceLine" id="cb20-9" title="9">  <span class="co">#   data &lt;- subset(polyData, propertyCity %in% event)</span></a>
<a class="sourceLine" id="cb20-10" title="10">  <span class="co">#   updateSelectInput(session = session, inputId = &quot;municipio&quot;,</span></a>
<a class="sourceLine" id="cb20-11" title="11">  <span class="co">#                     selected = levels(data$municipio))</span></a>
<a class="sourceLine" id="cb20-12" title="12">  <span class="co"># })</span></a>
<a class="sourceLine" id="cb20-13" title="13">  </a>
<a class="sourceLine" id="cb20-14" title="14">  <span class="co"># reactiveInputData &lt;- reactive({</span></a>
<a class="sourceLine" id="cb20-15" title="15">  <span class="co">#   subset(polyData, propertyCity %in% input$propertyCity &amp; municipio %in% input$municipio &amp; distrito %in% input$distrito)</span></a>
<a class="sourceLine" id="cb20-16" title="16">  <span class="co"># })</span></a>
<a class="sourceLine" id="cb20-17" title="17">  <span class="kw">observe</span>({</a>
<a class="sourceLine" id="cb20-18" title="18">    event &lt;-<span class="st"> </span>input<span class="op">$</span>heatmap_shape_click</a>
<a class="sourceLine" id="cb20-19" title="19">    <span class="kw">updateSelectInput</span>(session, <span class="dt">inputId =</span> <span class="st">&quot;distrito&quot;</span>, <span class="dt">selected =</span> event<span class="op">$</span>id)</a>
<a class="sourceLine" id="cb20-20" title="20">    <span class="kw">updateSelectInput</span>(session, <span class="dt">inputId =</span> <span class="st">&quot;propertyCity&quot;</span>, <span class="dt">selected =</span> <span class="kw">levels</span>(polyData<span class="op">$</span>propertyCity))</a>
<a class="sourceLine" id="cb20-21" title="21">    <span class="kw">updateSelectInput</span>(session, <span class="dt">inputId =</span> <span class="st">&quot;municipio&quot;</span>, <span class="dt">selected =</span> <span class="kw">levels</span>(polyData<span class="op">$</span>municipio))</a>
<a class="sourceLine" id="cb20-22" title="22">  })</a>
<a class="sourceLine" id="cb20-23" title="23">  </a>
<a class="sourceLine" id="cb20-24" title="24">  <span class="kw">observe</span>({</a>
<a class="sourceLine" id="cb20-25" title="25">    event &lt;-<span class="st"> </span>input<span class="op">$</span>heatmap_marker_click</a>
<a class="sourceLine" id="cb20-26" title="26">    <span class="kw">updateSelectInput</span>(session, <span class="dt">inputId =</span> <span class="st">&quot;distrito&quot;</span>, <span class="dt">selected =</span> event<span class="op">$</span>id)</a>
<a class="sourceLine" id="cb20-27" title="27">    <span class="kw">updateSelectInput</span>(session, <span class="dt">inputId =</span> <span class="st">&quot;propertyCity&quot;</span>, <span class="dt">selected =</span> <span class="kw">levels</span>(polyData<span class="op">$</span>propertyCity))</a>
<a class="sourceLine" id="cb20-28" title="28">    <span class="kw">updateSelectInput</span>(session, <span class="dt">inputId =</span> <span class="st">&quot;municipio&quot;</span>, <span class="dt">selected =</span> <span class="kw">levels</span>(polyData<span class="op">$</span>municipio))</a>
<a class="sourceLine" id="cb20-29" title="29">  })</a>
<a class="sourceLine" id="cb20-30" title="30">  </a>
<a class="sourceLine" id="cb20-31" title="31">  output<span class="op">$</span>heatmap &lt;-<span class="st"> </span><span class="kw">renderLeaflet</span>({</a>
<a class="sourceLine" id="cb20-32" title="32">    <span class="kw">loadHeatmap</span>(polyData, input<span class="op">$</span>color)</a>
<a class="sourceLine" id="cb20-33" title="33">  })</a>
<a class="sourceLine" id="cb20-34" title="34">  </a>
<a class="sourceLine" id="cb20-35" title="35">  reactiveDistrictData &lt;-<span class="st"> </span><span class="kw">reactive</span>({</a>
<a class="sourceLine" id="cb20-36" title="36">    heatmapData <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-37" title="37"><span class="st">      </span><span class="kw">filter</span>(propertyCity <span class="op">%in%</span><span class="st"> </span>input<span class="op">$</span>propertyCity <span class="op">&amp;</span><span class="st"> </span>municipio <span class="op">%in%</span><span class="st"> </span>input<span class="op">$</span>municipio <span class="op">&amp;</span><span class="st"> </span>distrito <span class="op">%in%</span><span class="st"> </span>input<span class="op">$</span>distrito <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(monthlyPrice) <span class="op">&amp;</span><span class="st"> </span>beds <span class="op">%in%</span><span class="st"> </span>input<span class="op">$</span>beds <span class="op">&amp;</span><span class="st"> </span>rooms <span class="op">%in%</span><span class="st"> </span>input<span class="op">$</span>rooms) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-38" title="38"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">monthlyPrice =</span> <span class="kw">round</span>(monthlyPrice, <span class="dv">0</span>), <span class="dt">duration =</span> <span class="kw">round</span>(duration, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb20-39" title="39">  })</a>
<a class="sourceLine" id="cb20-40" title="40">  </a>
<a class="sourceLine" id="cb20-41" title="41">  reactivePropertiesData &lt;-<span class="st"> </span><span class="kw">reactive</span>({</a>
<a class="sourceLine" id="cb20-42" title="42">    properties <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-43" title="43"><span class="st">      </span><span class="kw">filter</span>(distrito <span class="op">%in%</span><span class="st"> </span>input<span class="op">$</span>distrito, <span class="op">!</span><span class="kw">is.na</span>(hasICal)) <span class="co">#%&gt;%</span></a>
<a class="sourceLine" id="cb20-44" title="44">      <span class="co"># group_by(rooms) %&gt;%</span></a>
<a class="sourceLine" id="cb20-45" title="45">      <span class="co"># summarise(numberOfProperties = n(), withIcal = sum(hasICal))</span></a>
<a class="sourceLine" id="cb20-46" title="46">  })</a>
<a class="sourceLine" id="cb20-47" title="47">  </a>
<a class="sourceLine" id="cb20-48" title="48">  output<span class="op">$</span>pricesLine &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({</a>
<a class="sourceLine" id="cb20-49" title="49">    data &lt;-<span class="st"> </span><span class="kw">reactiveDistrictData</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-50" title="50"><span class="st">      </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(monthlyPrice) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(rooms) <span class="op">&amp;</span><span class="st"> </span>rooms <span class="op">!=</span><span class="st"> &quot;nan&quot;</span>)</a>
<a class="sourceLine" id="cb20-51" title="51">    </a>
<a class="sourceLine" id="cb20-52" title="52">    data<span class="op">$</span>rooms &lt;-<span class="st"> </span><span class="kw">factor</span>(data<span class="op">$</span>rooms,</a>
<a class="sourceLine" id="cb20-53" title="53">                         <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;0.0&quot;</span>, <span class="st">&quot;1.0&quot;</span>, <span class="st">&quot;2.0&quot;</span>, <span class="st">&quot;3.0&quot;</span>, <span class="st">&quot;4.0&quot;</span>, <span class="st">&quot;&gt;4&quot;</span>), <span class="dt">ordered =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb20-54" title="54">    </a>
<a class="sourceLine" id="cb20-55" title="55">    p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> data, <span class="kw">aes</span>(<span class="dt">y =</span> monthlyPrice, <span class="dt">group =</span> rooms, <span class="dt">color =</span> rooms, <span class="dt">text =</span> <span class="kw">toMoney</span>(monthlyPrice))) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-56" title="56"><span class="st">      </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-57" title="57"><span class="st">      </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5000</span>), <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">5000</span>, <span class="dv">500</span>), <span class="dt">name =</span> <span class="st">&quot;Alquiler Mensual&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-58" title="58"><span class="st">      </span><span class="kw">scale_x_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Número de habitaciones&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-59" title="59"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Alquiler de precios de alquiler en función del número de habitaciones&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;Homyspace&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Número de habitaciones&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-60" title="60"><span class="st">      </span><span class="kw">theme_minimal</span>()</a>
<a class="sourceLine" id="cb20-61" title="61">    </a>
<a class="sourceLine" id="cb20-62" title="62">    <span class="kw">ggplotly</span>(p, <span class="dt">tooltip =</span> <span class="st">&quot;y&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-63" title="63"><span class="st">      </span><span class="kw">layout</span>(<span class="dt">boxmode=</span><span class="st">&#39;group&#39;</span>,</a>
<a class="sourceLine" id="cb20-64" title="64">             <span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">autorange =</span> T))</a>
<a class="sourceLine" id="cb20-65" title="65">  })</a>
<a class="sourceLine" id="cb20-66" title="66">  </a>
<a class="sourceLine" id="cb20-67" title="67">  output<span class="op">$</span>roomsBar &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({</a>
<a class="sourceLine" id="cb20-68" title="68">    data &lt;-<span class="st"> </span><span class="kw">reactiveDistrictData</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-69" title="69"><span class="st">      </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(rooms) <span class="op">&amp;</span><span class="st"> </span>rooms <span class="op">!=</span><span class="st"> &quot;nan&quot;</span>)</a>
<a class="sourceLine" id="cb20-70" title="70">    </a>
<a class="sourceLine" id="cb20-71" title="71">    p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> data, <span class="kw">aes</span>(<span class="dt">x =</span> rooms, <span class="dt">fill =</span> proposalStage)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-72" title="72"><span class="st">      </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-73" title="73"><span class="st">      </span><span class="kw">scale_x_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Número de habitaciones&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-74" title="74"><span class="st">      </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Número de propuestas enviadas&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-75" title="75"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Número de propuestas aceptadas y rechazadas por número de habitaciones&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;Homyspace&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-76" title="76"><span class="st">      </span><span class="kw">theme_minimal</span>()</a>
<a class="sourceLine" id="cb20-77" title="77">    </a>
<a class="sourceLine" id="cb20-78" title="78">    <span class="kw">ggplotly</span>(p, <span class="dt">tooltip =</span> <span class="st">&quot;y&quot;</span>)</a>
<a class="sourceLine" id="cb20-79" title="79">  })</a>
<a class="sourceLine" id="cb20-80" title="80">  </a>
<a class="sourceLine" id="cb20-81" title="81">  output<span class="op">$</span>roomsPerDistrict &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({</a>
<a class="sourceLine" id="cb20-82" title="82">    data &lt;-<span class="st"> </span><span class="kw">reactivePropertiesData</span>()</a>
<a class="sourceLine" id="cb20-83" title="83">    </a>
<a class="sourceLine" id="cb20-84" title="84">    p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> data, <span class="kw">aes</span>(<span class="dt">x=</span>rooms, <span class="dt">fill=</span>rooms)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-85" title="85"><span class="st">      </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-86" title="86"><span class="st">      </span><span class="kw">scale_x_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Número de habitaciones&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-87" title="87"><span class="st">      </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Número de inmuebles&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-88" title="88"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Número de inmuebles por número de habitaciones&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;Homyspace&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-89" title="89"><span class="st">      </span><span class="kw">theme_minimal</span>()</a>
<a class="sourceLine" id="cb20-90" title="90">    </a>
<a class="sourceLine" id="cb20-91" title="91">    <span class="kw">ggplotly</span>(p, <span class="dt">tooltip =</span> <span class="st">&quot;y&quot;</span>)</a>
<a class="sourceLine" id="cb20-92" title="92">  })</a>
<a class="sourceLine" id="cb20-93" title="93">  </a>
<a class="sourceLine" id="cb20-94" title="94">  output<span class="op">$</span>hasIcal &lt;-<span class="st"> </span><span class="kw">renderPlotly</span>({</a>
<a class="sourceLine" id="cb20-95" title="95">    data &lt;-<span class="st"> </span><span class="kw">reactivePropertiesData</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-96" title="96"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-97" title="97"><span class="st">      </span><span class="kw">group_by</span>(hasICal) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-98" title="98"><span class="st">      </span><span class="kw">summarise</span>(<span class="dt">porcentaje =</span> <span class="kw">n</span>()<span class="op">/</span><span class="kw">mean</span>(n))</a>
<a class="sourceLine" id="cb20-99" title="99">    </a>
<a class="sourceLine" id="cb20-100" title="100">    p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> data, <span class="kw">aes</span>(<span class="dt">x=</span>hasICal, <span class="dt">y=</span>porcentaje, <span class="dt">fill=</span>hasICal)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-101" title="101"><span class="st">      </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-102" title="102"><span class="st">      </span><span class="kw">scale_x_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Tiene iCal&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-103" title="103"><span class="st">      </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Porcentaje de inmuebles&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-104" title="104"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Porcentaje de inmuebles con y sin iCal&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;Homyspace&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-105" title="105"><span class="st">      </span><span class="kw">theme_minimal</span>()</a>
<a class="sourceLine" id="cb20-106" title="106">    </a>
<a class="sourceLine" id="cb20-107" title="107">    <span class="kw">ggplotly</span>(p, <span class="dt">tooltip =</span> <span class="st">&quot;y&quot;</span>)</a>
<a class="sourceLine" id="cb20-108" title="108">  })</a>
<a class="sourceLine" id="cb20-109" title="109">  </a>
<a class="sourceLine" id="cb20-110" title="110">  output<span class="op">$</span>dataDistrito &lt;-<span class="st"> </span><span class="kw">renderDataTable</span>({</a>
<a class="sourceLine" id="cb20-111" title="111">    districtData &lt;-<span class="st"> </span><span class="kw">reactiveDistrictData</span>()</a>
<a class="sourceLine" id="cb20-112" title="112">    </a>
<a class="sourceLine" id="cb20-113" title="113">    <span class="kw">datatable</span>(districtData <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-114" title="114"><span class="st">                </span><span class="kw">group_by</span>(distrito) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-115" title="115"><span class="st">                </span><span class="kw">summarise</span>(<span class="dt">numeroPropuestas =</span> <span class="kw">n</span>(), <span class="dt">numeroReservas =</span> <span class="kw">sum</span>(proposalStage <span class="op">==</span><span class="st"> &quot;ACCEPTED&quot;</span>), <span class="dt">benchmark =</span> <span class="kw">round</span>(numeroReservas<span class="op">/</span>numeroPropuestas, <span class="dv">2</span>), <span class="dt">precioMensual =</span> <span class="kw">round</span>(<span class="kw">median</span>(monthlyPrice, <span class="dt">na.rm =</span> T), <span class="dv">2</span>), </a>
<a class="sourceLine" id="cb20-116" title="116">                          <span class="dt">duracionEstancia =</span> <span class="kw">median</span>(duration, <span class="dt">na.rm =</span> T),</a>
<a class="sourceLine" id="cb20-117" title="117">                          <span class="dt">inmuebles =</span> <span class="kw">length</span>(<span class="kw">unique</span>(propertyId)),</a>
<a class="sourceLine" id="cb20-118" title="118">                          <span class="dt">inmueblesConvertidos =</span> <span class="kw">n_distinct</span>(propertyId[proposalStage <span class="op">==</span><span class="st"> &quot;ACCEPTED&quot;</span>])</a>
<a class="sourceLine" id="cb20-119" title="119">                ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-120" title="120"><span class="st">                </span><span class="kw">arrange</span>(<span class="kw">desc</span>(numeroPropuestas)),</a>
<a class="sourceLine" id="cb20-121" title="121">              <span class="dt">filter =</span> <span class="st">&quot;top&quot;</span>,</a>
<a class="sourceLine" id="cb20-122" title="122">              <span class="dt">selection=</span><span class="st">&quot;multiple&quot;</span>,</a>
<a class="sourceLine" id="cb20-123" title="123">              <span class="dt">options =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb20-124" title="124">                <span class="co"># autoWidth = TRUE,</span></a>
<a class="sourceLine" id="cb20-125" title="125">                <span class="dt">sDom  =</span> <span class="st">&#39;&lt;&quot;top&quot;&gt;lrt&lt;&quot;bottom&quot;&gt;ip&#39;</span>,</a>
<a class="sourceLine" id="cb20-126" title="126">                <span class="dt">ordering =</span> T,</a>
<a class="sourceLine" id="cb20-127" title="127">                <span class="dt">scrollX =</span> T</a>
<a class="sourceLine" id="cb20-128" title="128">                <span class="co"># lengthChange = FALSE,</span></a>
<a class="sourceLine" id="cb20-129" title="129">                <span class="co"># info = FALSE,</span></a>
<a class="sourceLine" id="cb20-130" title="130">                <span class="co"># paging = F</span></a>
<a class="sourceLine" id="cb20-131" title="131">              ),</a>
<a class="sourceLine" id="cb20-132" title="132">              <span class="dt">rownames =</span> F</a>
<a class="sourceLine" id="cb20-133" title="133">    )</a>
<a class="sourceLine" id="cb20-134" title="134">  })</a>
<a class="sourceLine" id="cb20-135" title="135"></a>
<a class="sourceLine" id="cb20-136" title="136">}</a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="co">#####</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="co">##### Cargamos la aplicación con la interfaz de usuario (ui) y el servidor (server)</span></a>
<a class="sourceLine" id="cb21-3" title="3"></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</a></code></pre></div>

</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="desarrollo-de-la-etl-pipeline.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="referencias.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
